{"version":3,"sources":["form/util.js"],"names":["useCacheErrors","errors","changeTrigger","cacheRef","React","useRef","visible","length","useEffect","timeout","setTimeout","prevVisible","current","newVisible","clearTimeout","toArray","candidate","undefined","Array","isArray","getFieldId","namePath","formName","mergedId","join","useForm","form","wrapForm","__INTERNAL__","scrollToField","name","fieldId","node","document","getElementById","scrollMode","block"],"mappings":";;;;;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;AACA;;;AAGO,SAASA,cAAT,CAAwBC,MAAxB,EAAgCC,aAAhC,EAA+C;AAClD,MAAMC,QAAQ,GAAGC,KAAK,CAACC,MAAN,CAAa;AAC1BJ,IAAAA,MAAM,EAANA,MAD0B;AAE1BK,IAAAA,OAAO,EAAE,CAAC,CAACL,MAAM,CAACM;AAFQ,GAAb,CAAjB;AAIAH,EAAAA,KAAK,CAACI,SAAN,CAAgB,YAAM;AAClB,QAAMC,OAAO,GAAGC,UAAU,CAAC,YAAM;AAC7B,UAAMC,WAAW,GAAGR,QAAQ,CAACS,OAAT,CAAiBN,OAArC;AACA,UAAMO,UAAU,GAAG,CAAC,CAACZ,MAAM,CAACM,MAA5B;AACAJ,MAAAA,QAAQ,CAACS,OAAT,CAAiBX,MAAjB,GAA0BA,MAA1B;AACAE,MAAAA,QAAQ,CAACS,OAAT,CAAiBN,OAAjB,GAA2BO,UAA3B;;AACA,UAAIF,WAAW,KAAKE,UAApB,EAAgC;AAC5BX,QAAAA,aAAa,CAACW,UAAD,CAAb;AACH;AACJ,KARyB,EAQvB,EARuB,CAA1B;AASA,WAAO;AAAA,aAAMC,YAAY,CAACL,OAAD,CAAlB;AAAA,KAAP;AACH,GAXD,EAWG,CAACR,MAAD,CAXH;AAYA,SAAO,CAACE,QAAQ,CAACS,OAAT,CAAiBN,OAAlB,EAA2BH,QAAQ,CAACS,OAAT,CAAiBX,MAA5C,CAAP;AACH;;AACM,SAASc,OAAT,CAAiBC,SAAjB,EAA4B;AAC/B,MAAIA,SAAS,KAAKC,SAAd,IAA2BD,SAAS,KAAK,KAA7C,EACI,OAAO,EAAP;AACJ,SAAOE,KAAK,CAACC,OAAN,CAAcH,SAAd,IAA2BA,SAA3B,GAAuC,CAACA,SAAD,CAA9C;AACH;;AACM,SAASI,UAAT,CAAoBC,QAApB,EAA8BC,QAA9B,EAAwC;AAC3C,MAAI,CAACD,QAAQ,CAACd,MAAd,EACI,OAAOU,SAAP;AACJ,MAAMM,QAAQ,GAAGF,QAAQ,CAACG,IAAT,CAAc,GAAd,CAAjB;AACA,SAAOF,QAAQ,aAAMA,QAAN,cAAkBC,QAAlB,IAA+BA,QAA9C;AACH;;AACM,SAASE,OAAT,CAAiBC,IAAjB,EAAuB;AAC1B,MAAMC,QAAQ,GAAGD,IAAI,IAAI,SAAc,SAAc,EAAd,EAAkB,4BAAY,CAAZ,CAAlB,CAAd,EAAiD;AAAEE,IAAAA,YAAY,EAAE,EAAhB;AAAoBC,IAAAA,aAAa,EAAE,uBAAAC,IAAI,EAAI;AAC7G,UAAMT,QAAQ,GAAGN,OAAO,CAACe,IAAD,CAAxB;AACA,UAAMC,OAAO,GAAGX,UAAU,CAACC,QAAD,EAAWM,QAAQ,CAACC,YAAT,CAAsBE,IAAjC,CAA1B;AACA,UAAME,IAAI,GAAGD,OAAO,GAAGE,QAAQ,CAACC,cAAT,CAAwBH,OAAxB,CAAH,GAAsC,IAA1D;;AACA,UAAIC,IAAJ,EAAU;AACN,gDAAeA,IAAf,EAAqB;AACjBG,UAAAA,UAAU,EAAE,WADK;AAEjBC,UAAAA,KAAK,EAAE;AAFU,SAArB;AAIH;AACJ;AAVqE,GAAjD,CAAzB;;AAWA,SAAO,CAACT,QAAD,CAAP;AACH","sourcesContent":["import * as React from 'react';\nimport { useForm as useRcForm } from 'rc-field-form';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n/**\n * Always debounce error to avoid [error -> null -> error] blink\n */\nexport function useCacheErrors(errors, changeTrigger) {\n    const cacheRef = React.useRef({\n        errors,\n        visible: !!errors.length,\n    });\n    React.useEffect(() => {\n        const timeout = setTimeout(() => {\n            const prevVisible = cacheRef.current.visible;\n            const newVisible = !!errors.length;\n            cacheRef.current.errors = errors;\n            cacheRef.current.visible = newVisible;\n            if (prevVisible !== newVisible) {\n                changeTrigger(newVisible);\n            }\n        }, 10);\n        return () => clearTimeout(timeout);\n    }, [errors]);\n    return [cacheRef.current.visible, cacheRef.current.errors];\n}\nexport function toArray(candidate) {\n    if (candidate === undefined || candidate === false)\n        return [];\n    return Array.isArray(candidate) ? candidate : [candidate];\n}\nexport function getFieldId(namePath, formName) {\n    if (!namePath.length)\n        return undefined;\n    const mergedId = namePath.join('_');\n    return formName ? `${formName}_${mergedId}` : mergedId;\n}\nexport function useForm(form) {\n    const wrapForm = form || Object.assign(Object.assign({}, useRcForm()[0]), { __INTERNAL__: {}, scrollToField: name => {\n            const namePath = toArray(name);\n            const fieldId = getFieldId(namePath, wrapForm.__INTERNAL__.name);\n            const node = fieldId ? document.getElementById(fieldId) : null;\n            if (node) {\n                scrollIntoView(node, {\n                    scrollMode: 'if-needed',\n                    block: 'nearest',\n                });\n            }\n        } });\n    return [wrapForm];\n}\n"],"file":"util.js"}